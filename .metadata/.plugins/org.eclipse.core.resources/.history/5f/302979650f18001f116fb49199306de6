package com.example.config;

import com.example.model.Role;
import com.example.model.User;
import com.example.repository.RoleRepository;
import com.example.repository.UserRepository;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.CommandLineRunner;
import org.springframework.stereotype.Component;
import org.mindrot.jbcrypt.BCrypt;

import java.util.Date;

@Component
public class DataInitializer implements CommandLineRunner {

    @Autowired
    private RoleRepository roleRepository;

    @Autowired
    private UserRepository userRepository;

    @Override
    public void run(String... args) throws Exception {
        System.out.println("Initializing data...");

        // Thêm các vai trò nếu chưa có
        if (roleRepository.count() == 0) {
            System.out.println("Adding roles...");
            roleRepository.save(new Role(1, "STUDENT"));
            roleRepository.save(new Role(2, "PARENT"));
            roleRepository.save(new Role(3, "TEACHER"));
            roleRepository.save(new Role(4, "MANAGER"));
            roleRepository.save(new Role(5, "ADMIN"));
        }

        // Thêm người dùng mẫu nếu chưa có
        if (userRepository.count() == 0) {
            System.out.println("Adding users...");
            Role adminRole = roleRepository.findById(5).orElse(null);
            if (adminRole != null) {
                User admin = new User();
                admin.setUsername("admin");
                admin.setPassword(BCrypt.hashpw("password", BCrypt.gensalt()));
                admin.setStatus(true);
                admin.setCode(123456);
                admin.setName("Admin User");
                admin.setPhone("1234567890");
                admin.setAddress("123 Admin St");
                admin.setDob(new Date());
                admin.setGender(true);
                admin.setEmail("admin@example.com");
                admin.setRole(adminRole);
                userRepository.save(admin);
                System.out.println("Admin user added.");
            } else {
                System.out.println("Admin role not found.");
            }
        }

        System.out.println("Data initialization completed.");
    }
}
